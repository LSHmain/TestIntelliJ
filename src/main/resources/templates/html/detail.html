<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <title>상세 보기</title>
</head>
<body>
<h1>Board상세보기</h1>
<div th:replace="html/detail_display"></div>

<div th:replace="html/detail_modal"></div>
<script th:inline="javascript">
    $(function() {
        $(".replyCount").click(f_selectAll);
        $(".addReply").click(f_add);
        $(".replyClose, .close").click(f_close);
        $(".replySave").click(f_save);
        $(".replyList").on("click", ".card-body", f_detailDisplay);
        $(".replyModify").click(f_update);
        $(".replyRemove").click(f_delete);
    })
    function f_delete(){
        var bno = /*[[${board.bno}]]*/0;
        var rno = $("input[name='rno']").val();
        $.ajax({
            url: `/board/${bno}/replies/${rno}`,
            method: "DELETE",
            success: f_insertSuccess
        });
    }
    function f_update(){
        var replyText = $("input[name='replyText']").val();
        var replyer = $("input[name='replyer']").val();
        var bno = /*[[${board.bno}]]*/0;
        var rno = $("input[name='rno']").val();
        var insertData = {
            replyText,
            replyer,
            rno
        };
        $.ajax({
            url: `/board/${bno}/replies/${rno}`,
            method: "PUT",
            contentType: 'application/json',
            data:JSON.stringify(insertData),
            success: f_insertSuccess
        })
    }
    function f_detailDisplay() {
        var rno = $(this).data("rno");
        var replyText = $(this).data("replytext");
        var replyer = $(this).data("replyer");

        $("input[name='replyText']").val(replyText);
        $("input[name='replyer']").val(replyer);
        $("input[name='rno']").val(rno);
        $(".modal").show()
    }
    function f_save() {
        var replyText = $("input[name='replyText']").val();
        var replyer = $("input[name='replyer']").val();
        var bno = /*[[${board.bno}]]*/0;
        var insertData = {
            replyText,
            replyer
        };
        $.ajax({
            url: `/board/${bno}/replies`,
            method: "POST",
            contentType: 'application/json',
            data:JSON.stringify(insertData),
            success: f_insertSuccess
        })
    }
    function f_insertSuccess(responseData) {
        alert(responseData);
        f_close();
        f_selectAll();
    }
    function f_close(){
        $("input[name='replyText']").val("");
        $("input[name='replyer']").val("");
        $("input[name='rno']").val("");
        $(".modal").hide()
    }
    function f_add() {
        $(".modal").show()
    }
    function f_selectAll() {
        var bno = /*[[${board.bno}]]*/0;
        $.ajax({
            url:`/board/${bno}/replies`,
            success:f_display
        });
    }
    function f_display(replyList) {
        console.log(replyList);
        var output = '';
        $(".replyCount").html("Reply Count : " + replyList.length);
        $.each(replyList, function(index, reply){
            output += `
			      <div class="col-sm-6">
					  <div class='card card-body' data-rno='${reply.rno}' data-replyText="${reply.replyText}" data-replyer="${reply.replyer}" style="width: 28rem;"  >
	  				        <b>${reply.rno}</b>
	  				        <h5 class='card-title' >${reply.replyText}</h5>
	  				        <h5 class='card-subtitle mb-2 text-muted' >${reply.replyer}</h5>
	  				        <p class='card-text mb-2 text-muted card-regdate'>등록일: ${reply.regDate} </p>
	  				        <p class='card-text mb-2 text-muted'>수정일: ${reply.modDate} </p>
	  				  </div>
  			     </div> `;

        });
        $(".replyList").html(output);
    }

</script>

<script src="https://ajax.googleapis.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"></script>
</body>
</html>